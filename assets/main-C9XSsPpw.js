import"./animations-D-SwE_vs.js";document.addEventListener("DOMContentLoaded",()=>{const y=document.getElementById("navbar");if(y){const e=()=>{y.classList.toggle("scrolled",window.scrollY>50)};window.addEventListener("scroll",e,{passive:!0}),e()}const f=document.getElementById("theme-toggle");f&&(f.addEventListener("click",()=>{const o=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";f.classList.add("theme-toggle--switching"),setTimeout(()=>f.classList.remove("theme-toggle--switching"),400),document.documentElement.setAttribute("data-theme",o),localStorage.setItem("theme",o)}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("theme")||document.documentElement.setAttribute("data-theme",e.matches?"dark":"light")}));const g=document.getElementById("hamburger"),p=document.getElementById("nav-links");g&&p&&(g.addEventListener("click",()=>{g.classList.toggle("open"),p.classList.toggle("open")}),p.querySelectorAll("a").forEach(e=>{e.addEventListener("click",()=>{g.classList.remove("open"),p.classList.remove("open")})}),document.addEventListener("click",e=>{!g.contains(e.target)&&!p.contains(e.target)&&(g.classList.remove("open"),p.classList.remove("open"))}));const E=document.querySelectorAll(".reveal");if(E.length>0){const e=new IntersectionObserver(o=>{o.forEach(r=>{r.isIntersecting&&(r.target.classList.add("visible"),e.unobserve(r.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});E.forEach(o=>e.observe(o))}const b=document.querySelectorAll("section[id]");if(b.length>0){const e=new IntersectionObserver(o=>{o.forEach(r=>{if(r.isIntersecting){const i=r.target.getAttribute("id");document.querySelectorAll(".navbar__links a").forEach(t=>{t.classList.toggle("active",t.getAttribute("href")===`#${i}`)})}})},{threshold:.3});b.forEach(o=>e.observe(o))}const v=document.getElementById("recipe-carousels");if(v){const e=[{key:"Pasta",emoji:"üçù",dir:"pasta"},{key:"Pane",emoji:"ü•ñ",dir:"pane"},{key:"Pizza",emoji:"üçï",dir:"pizza"},{key:"Lievitati",emoji:"ü•ê",dir:"lievitati"},{key:"Dolci",emoji:"üç™",dir:"dolci"},{key:"Focaccia",emoji:"ü´ì",dir:"focaccia"}];fetch("/Ricettario/recipes.json").then(o=>o.json()).then(o=>{v.innerHTML="";const r={};o.recipes.forEach(t=>{r[t.category]||(r[t.category]=[]),r[t.category].push(t)}),e.forEach(t=>{const s=r[t.key];if(!s||s.length===0)return;const a=document.createElement("div");a.className="category-row reveal",a.dataset.category=t.key,a.innerHTML=`
            <div class="category-row__header">
              <h3 class="category-row__title">
                ${t.emoji} ${t.key}
                <span class="category-row__count">${s.length} ricette</span>
              </h3>
              <a href="ricette/${t.dir}/" class="category-row__link">Vedi tutte</a>
            </div>
            <div class="category-row__carousel-wrapper">
              <button class="carousel-arrow carousel-arrow--prev" aria-label="Precedente">‚Äπ</button>
              <div class="category-row__carousel">
                ${s.map(c=>`
                  <a href="${c.href}" class="recipe-card--compact" data-title="${c.title.toLowerCase()}" data-category="${c.category}">
                    <div class="recipe-card--compact__image-wrapper">
                      ${c.image?`<img src="${c.image}" alt="${c.title}" class="recipe-card--compact__image" loading="lazy">`:""}
                    </div>
                    <div class="recipe-card--compact__body">
                      <h4 class="recipe-card--compact__title">${c.title}</h4>
                      <div class="recipe-card--compact__meta">
                        ${c.hydration?`<span class="recipe-card--compact__tag">üíß ${c.hydration}</span>`:""}
                        ${c.time?`<span>‚è±Ô∏è ${c.time}</span>`:""}
                      </div>
                    </div>
                  </a>
                `).join("")}
              </div>
              <button class="carousel-arrow carousel-arrow--next" aria-label="Successivo">‚Ä∫</button>
            </div>
          `,v.appendChild(a);const d=a.querySelector(".category-row__carousel"),l=a.querySelector(".category-row__carousel-wrapper"),n=a.querySelector(".carousel-arrow--prev"),m=a.querySelector(".carousel-arrow--next"),_=276,S=()=>{const{scrollLeft:c,scrollWidth:A,clientWidth:x}=d;l.classList.toggle("has-scroll-left",c>10),l.classList.toggle("has-scroll-right",c<A-x-10),n.disabled=c<=10,m.disabled=c>=A-x-10};d.addEventListener("scroll",S,{passive:!0}),requestAnimationFrame(S),n.addEventListener("click",()=>{d.scrollBy({left:-_*3,behavior:"smooth"})}),m.addEventListener("click",()=>{d.scrollBy({left:_*3,behavior:"smooth"})})});const i=v.querySelectorAll(".reveal");if(i.length>0){const t=new IntersectionObserver(s=>{s.forEach(a=>{a.isIntersecting&&(a.target.classList.add("visible"),t.unobserve(a.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});i.forEach(s=>t.observe(s))}$()}).catch(o=>{console.error("Errore caricamento recipes.json:",o),v.innerHTML='<p style="text-align:center; color: var(--color-text-muted);">Errore nel caricamento delle ricette.</p>'})}function $(){const e=document.getElementById("search-input");e&&(e.addEventListener("input",()=>{const o=e.value.toLowerCase().trim(),r=document.querySelectorAll(".recipe-card--compact"),i=document.querySelectorAll(".category-row");r.forEach(t=>{const s=t.dataset.title||t.textContent.toLowerCase();t.style.display=!o||s.includes(o)?"":"none"}),i.forEach(t=>{const s=t.querySelectorAll('.recipe-card--compact:not([style*="display: none"])');t.style.display=s.length>0?"":"none"})}),document.addEventListener("keydown",o=>{o.key==="/"&&document.activeElement!==e&&(o.preventDefault(),e.focus(),e.scrollIntoView({behavior:"smooth",block:"center"})),o.key==="Escape"&&document.activeElement===e&&(e.value="",e.dispatchEvent(new Event("input")),e.blur())}))}const w=document.getElementById("current-year");w&&(w.textContent=new Date().getFullYear());const h=document.getElementById("setup-badge");if(h){const e=document.getElementById("hero-setup-tag"),o=document.getElementById("setup-badge-value"),r=document.querySelectorAll(".recipe-panel[data-setup]"),i={spirale:{icon:"üîß",label:"Impastatrice a spirale"},estrusore:{icon:"üîß",label:"Estrusore con trafila"},mano:{icon:"ü§≤",label:"A mano"}},t=[];r.forEach(l=>{const n=l.getAttribute("data-setup");i[n]&&t.push({id:n,...i[n]})}),t.length<=1&&(h.style.cursor="default",h.removeAttribute("role"),h.removeAttribute("tabindex"));let s=0;const a=l=>{s=l;const n=t[l];r.forEach(m=>{m.getAttribute("data-setup")!=="condimento"&&(m.style.display=m.getAttribute("data-setup")===n.id?"":"none")}),e&&(e.textContent=`${n.icon} ${n.label}`),o&&(o.textContent=`¬†${n.label}`),document.querySelectorAll(".ingredient-note[data-setup-note-"+n.id+"]").forEach(m=>{m.textContent=m.getAttribute("data-setup-note-"+n.id)}),localStorage.setItem("recipe-setup",n.id)};t.length>1&&(h.addEventListener("click",()=>{a((s+1)%t.length)}),h.addEventListener("keydown",l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),a((s+1)%t.length))}));const d=localStorage.getItem("recipe-setup");if(d){const l=t.findIndex(n=>n.id===d);l!==-1&&a(l)}}const u=document.getElementById("dose-input"),L=document.getElementById("dose-badge"),k=document.getElementById("dose-decrease"),I=document.getElementById("dose-increase");if(u&&L){const e=document.querySelectorAll(".ingredient-qty[data-base]"),r=(parseFloat(u.getAttribute("data-base-total"))||1e3)/1e3,i=()=>{const a=(parseFloat(u.value)||r)/r;L.textContent=a===1?"√ó1":`√ó${a%1===0?a:a.toFixed(1)}`,e.forEach(d=>{const n=parseFloat(d.getAttribute("data-base"))*a,m=n>=10?`${Math.round(n)}g`:`${Math.round(n*10)/10}g`;d.textContent=m,d.classList.remove("dose-updated"),d.offsetWidth,d.classList.add("dose-updated")})};u.addEventListener("input",i),u.addEventListener("change",i);const t=r<=.5?r:.5;k&&k.addEventListener("click",()=>{const s=parseFloat(u.value)||r,a=parseFloat(u.min)||t;s>a&&(u.value=Math.round((s-t)*10)/10,i())}),I&&I.addEventListener("click",()=>{const s=parseFloat(u.value)||r,a=parseFloat(u.max)||5;s<a&&(u.value=Math.round((s+t)*10)/10,i())}),i()}"startViewTransition"in document&&document.querySelectorAll("a[href]").forEach(e=>{const o=e.getAttribute("href");o&&o.endsWith(".html")&&!o.startsWith("http")&&e.addEventListener("click",r=>{r.preventDefault(),document.startViewTransition(()=>{window.location.href=o})})})});
