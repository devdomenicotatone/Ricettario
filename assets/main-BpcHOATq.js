import"./animations-D-SwE_vs.js";document.addEventListener("DOMContentLoaded",()=>{const y=document.getElementById("navbar");if(y){const t=()=>{y.classList.toggle("scrolled",window.scrollY>50)};window.addEventListener("scroll",t,{passive:!0}),t()}const f=document.getElementById("theme-toggle");f&&(f.addEventListener("click",()=>{const a=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";f.classList.add("theme-toggle--switching"),setTimeout(()=>f.classList.remove("theme-toggle--switching"),400),document.documentElement.setAttribute("data-theme",a),localStorage.setItem("theme",a)}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{localStorage.getItem("theme")||document.documentElement.setAttribute("data-theme",t.matches?"dark":"light")}));const m=document.getElementById("hamburger"),g=document.getElementById("nav-links");m&&g&&(m.addEventListener("click",()=>{m.classList.toggle("open"),g.classList.toggle("open")}),g.querySelectorAll("a").forEach(t=>{t.addEventListener("click",()=>{m.classList.remove("open"),g.classList.remove("open")})}),document.addEventListener("click",t=>{!m.contains(t.target)&&!g.contains(t.target)&&(m.classList.remove("open"),g.classList.remove("open"))}));const E=document.querySelectorAll(".reveal");if(E.length>0){const t=new IntersectionObserver(a=>{a.forEach(s=>{s.isIntersecting&&(s.target.classList.add("visible"),t.unobserve(s.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});E.forEach(a=>t.observe(a))}const b=document.querySelectorAll("section[id]");if(b.length>0){const t=new IntersectionObserver(a=>{a.forEach(s=>{if(s.isIntersecting){const l=s.target.getAttribute("id");document.querySelectorAll(".navbar__links a").forEach(e=>{e.classList.toggle("active",e.getAttribute("href")===`#${l}`)})}})},{threshold:.3});b.forEach(a=>t.observe(a))}const v=document.getElementById("recipe-carousels");if(v){const t=[{key:"Pasta",emoji:"üçù",dir:"pasta"},{key:"Pane",emoji:"ü•ñ",dir:"pane"},{key:"Pizza",emoji:"üçï",dir:"pizza"},{key:"Lievitati",emoji:"ü•ê",dir:"lievitati"},{key:"Focaccia",emoji:"ü´ì",dir:"focaccia"}];fetch("/Ricettario/recipes.json").then(a=>a.json()).then(a=>{v.innerHTML="";const s={};a.recipes.forEach(e=>{s[e.category]||(s[e.category]=[]),s[e.category].push(e)}),t.forEach(e=>{const o=s[e.key];if(!o||o.length===0)return;const r=document.createElement("div");r.className="category-row reveal",r.dataset.category=e.key,r.innerHTML=`
            <div class="category-row__header">
              <h3 class="category-row__title">
                ${e.emoji} ${e.key}
                <span class="category-row__count">${o.length} ricette</span>
              </h3>
              <a href="ricette/${e.dir}/" class="category-row__link">Vedi tutte</a>
            </div>
            <div class="category-row__carousel-wrapper">
              <button class="carousel-arrow carousel-arrow--prev" aria-label="Precedente">‚Äπ</button>
              <div class="category-row__carousel">
                ${o.map(i=>`
                  <a href="${i.href}" class="recipe-card--compact" data-title="${i.title.toLowerCase()}" data-category="${i.category}">
                    <div class="recipe-card--compact__image-wrapper">
                      ${i.image?`<img src="${i.image}" alt="${i.title}" class="recipe-card--compact__image" loading="lazy">`:""}
                    </div>
                    <div class="recipe-card--compact__body">
                      <h4 class="recipe-card--compact__title">${i.title}</h4>
                      <div class="recipe-card--compact__meta">
                        ${i.hydration?`<span class="recipe-card--compact__tag">üíß ${i.hydration}</span>`:""}
                        ${i.time?`<span>‚è±Ô∏è ${i.time}</span>`:""}
                      </div>
                    </div>
                  </a>
                `).join("")}
              </div>
              <button class="carousel-arrow carousel-arrow--next" aria-label="Successivo">‚Ä∫</button>
            </div>
          `,v.appendChild(r);const u=r.querySelector(".category-row__carousel"),c=r.querySelector(".category-row__carousel-wrapper"),n=r.querySelector(".carousel-arrow--prev"),h=r.querySelector(".carousel-arrow--next"),_=276,S=()=>{const{scrollLeft:i,scrollWidth:x,clientWidth:A}=u;c.classList.toggle("has-scroll-left",i>10),c.classList.toggle("has-scroll-right",i<x-A-10),n.disabled=i<=10,h.disabled=i>=x-A-10};u.addEventListener("scroll",S,{passive:!0}),requestAnimationFrame(S),n.addEventListener("click",()=>{u.scrollBy({left:-_*3,behavior:"smooth"})}),h.addEventListener("click",()=>{u.scrollBy({left:_*3,behavior:"smooth"})})});const l=v.querySelectorAll(".reveal");if(l.length>0){const e=new IntersectionObserver(o=>{o.forEach(r=>{r.isIntersecting&&(r.target.classList.add("visible"),e.unobserve(r.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});l.forEach(o=>e.observe(o))}$()}).catch(a=>{console.error("Errore caricamento recipes.json:",a),v.innerHTML='<p style="text-align:center; color: var(--color-text-muted);">Errore nel caricamento delle ricette.</p>'})}function $(){const t=document.getElementById("search-input");t&&(t.addEventListener("input",()=>{const a=t.value.toLowerCase().trim(),s=document.querySelectorAll(".recipe-card--compact"),l=document.querySelectorAll(".category-row");s.forEach(e=>{const o=e.dataset.title||e.textContent.toLowerCase();e.style.display=!a||o.includes(a)?"":"none"}),l.forEach(e=>{const o=e.querySelectorAll('.recipe-card--compact:not([style*="display: none"])');e.style.display=o.length>0?"":"none"})}),document.addEventListener("keydown",a=>{a.key==="/"&&document.activeElement!==t&&(a.preventDefault(),t.focus(),t.scrollIntoView({behavior:"smooth",block:"center"})),a.key==="Escape"&&document.activeElement===t&&(t.value="",t.dispatchEvent(new Event("input")),t.blur())}))}const w=document.getElementById("current-year");w&&(w.textContent=new Date().getFullYear());const p=document.getElementById("setup-badge");if(p){const t=document.getElementById("hero-setup-tag"),a=document.getElementById("setup-badge-value"),s=document.querySelectorAll(".recipe-panel[data-setup]"),l={spirale:{icon:"üîß",label:"Impastatrice a spirale"},estrusore:{icon:"üîß",label:"Estrusore con trafila"},mano:{icon:"ü§≤",label:"A mano"}},e=[];s.forEach(c=>{const n=c.getAttribute("data-setup");l[n]&&e.push({id:n,...l[n]})}),e.length<=1&&(p.style.cursor="default",p.removeAttribute("role"),p.removeAttribute("tabindex"));let o=0;const r=c=>{o=c;const n=e[c];s.forEach(h=>{h.getAttribute("data-setup")!=="condimento"&&(h.style.display=h.getAttribute("data-setup")===n.id?"":"none")}),t&&(t.textContent=`${n.icon} ${n.label}`),a&&(a.textContent=`¬†${n.label}`),localStorage.setItem("recipe-setup",n.id)};e.length>1&&(p.addEventListener("click",()=>{r((o+1)%e.length)}),p.addEventListener("keydown",c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),r((o+1)%e.length))}));const u=localStorage.getItem("recipe-setup");if(u){const c=e.findIndex(n=>n.id===u);c!==-1&&r(c)}}const d=document.getElementById("dose-input"),L=document.getElementById("dose-badge"),k=document.getElementById("dose-decrease"),I=document.getElementById("dose-increase");if(d&&L){const t=document.querySelectorAll(".ingredient-qty[data-base]"),s=(parseFloat(d.getAttribute("data-base-total"))||1e3)/1e3,l=()=>{const o=(parseFloat(d.value)||s)/s;L.textContent=o===1?"√ó1":`√ó${o%1===0?o:o.toFixed(1)}`,t.forEach(r=>{const c=parseFloat(r.getAttribute("data-base"))*o,n=c>=10?`${Math.round(c)}g`:`${Math.round(c*10)/10}g`;r.textContent=n,r.classList.remove("dose-updated"),r.offsetWidth,r.classList.add("dose-updated")})};d.addEventListener("input",l),d.addEventListener("change",l),k&&k.addEventListener("click",()=>{const e=parseFloat(d.value)||1,o=parseFloat(d.min)||.5;e>o&&(d.value=(e-.5).toFixed(1),l())}),I&&I.addEventListener("click",()=>{const e=parseFloat(d.value)||1,o=parseFloat(d.max)||5;e<o&&(d.value=(e+.5).toFixed(1),l())})}"startViewTransition"in document&&document.querySelectorAll("a[href]").forEach(t=>{const a=t.getAttribute("href");a&&a.endsWith(".html")&&!a.startsWith("http")&&t.addEventListener("click",s=>{s.preventDefault(),document.startViewTransition(()=>{window.location.href=a})})})});
